@inject HttpClient Http
@using CFDA2.Shared.ViewModels

<h3>Dashboard</h3>

@if (_loading)
{
    <p>Loading...</p>
}
else
{
    <div class="mb-3">
        <strong>Balance:</strong> @(_balance.BalanceCents / 100.0m).ToString("C2")
    </div>
    <div class="mb-3">
        <strong>Autopay:</strong> @(_autopay.Enabled ? "Enabled" : "Disabled")
    </div>
}

@code {
    private BalanceView _balance = new();
    private AutopayStatusView _autopay = new();
    private bool _loading = true;
    protected override async Task OnInitializedAsync()
    {
        try
        {
            _balance = await Http.GetFromJsonAsync<BalanceView>("/api/portal/balance");
            _autopay = await Http.GetFromJsonAsync<AutopayStatusView>("/api/portal/autopay/status");
        }
        catch
        {
        }
        _loading = false;
    }
}
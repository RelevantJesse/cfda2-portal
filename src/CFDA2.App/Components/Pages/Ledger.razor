@inject HttpClient Http
@using CFDA2.Shared.ViewModels

<h3>Ledger</h3>

<table class="table table-sm">
    <thead>
        <tr>
            <th>Date</th>
            <th>Type</th>
            <th>Amount</th>
            <th>Memo</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in _items)
        {
            <tr>
                <td>@item.Date.ToString("yyyy-MM-dd")</td>
                <td>@item.Type</td>
                <td>@(item.AmountCents / 100.0m).ToString("C2")</td>
                <td>@item.Memo</td>
            </tr>
        }
    </tbody>
</table>
<button class="btn btn-secondary me-1" @onclick="Prev" disabled="@(_page <= 1)">Prev</button>
<button class="btn btn-secondary" @onclick="Next" disabled="@(_items.Count < _size)">Next</button>

@code {
    private List<LedgerEntryView> _items = new();
    private int _page = 1;
    private int _size = 20;

    protected override async Task OnInitializedAsync()
    {
        await Load();
    }
    private async Task Load()
    {
        var result = await Http.GetFromJsonAsync<PagedResult<LedgerEntryView>>($"/api/portal/ledger?page={_page}&size={_size}");
        _items = result?.Items.ToList() ?? new List<LedgerEntryView>();
    }
    private async Task Prev()
    {
        if (_page > 1)
        {
            _page--;
            await Load();
        }
    }
    private async Task Next()
    {
        _page++;
        await Load();
    }
}
@inject HttpClient Http
@using CFDA2.Shared.ViewModels

<h3>Families</h3>

<table class="table table-sm">
    <thead>
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Balance</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var f in _families)
        {
            <tr>
                <td>@f.Name</td>
                <td>@f.Email</td>
                <td>@f.Phone</td>
                <td>@(f.BalanceCents / 100.0m).ToString("C2")</td>
            </tr>
        }
    </tbody>
</table>

<h4>Add Family</h4>
<EditForm Model="_newFamily" OnValidSubmit="Create">
    <DataAnnotationsValidator />
    <ValidationSummary />
    <div class="mb-2">
        <InputText class="form-control" @bind-Value="_newFamily.Name" placeholder="Name" />
    </div>
    <div class="mb-2">
        <InputText class="form-control" @bind-Value="_newFamily.Email" placeholder="Email" />
    </div>
    <div class="mb-2">
        <InputText class="form-control" @bind-Value="_newFamily.Phone" placeholder="Phone" />
    </div>
    <button class="btn btn-primary">Create</button>
</EditForm>

@code {
    private List<FamilyAdminView> _families = new();
    private FamilyCreateRequest _newFamily = new();
    protected override async Task OnInitializedAsync()
    {
        await Load();
    }
    private async Task Load()
    {
        _families = (await Http.GetFromJsonAsync<List<FamilyAdminView>>("/api/admin/families")) ?? new List<FamilyAdminView>();
    }
    private async Task Create()
    {
        await Http.PostAsJsonAsync("/api/admin/families", _newFamily);
        _newFamily = new FamilyCreateRequest();
        await Load();
    }
}